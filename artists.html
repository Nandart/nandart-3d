<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NANdART Artist Panel</title>
  <link rel="stylesheet" href="index.css" />
</head>
<body>
  <header>
    <h1>NANdART | Artist & Curator Panel</h1>
  </header>

  <main>
    <section id="artist-section" class="panel-section hidden">
      <h2>Submit Artwork</h2>
      <form id="submit-art-form">
        <input type="text" id="title" placeholder="Title" required />
        <input type="text" id="year" placeholder="Year" required />
        <textarea id="description" placeholder="Description" required></textarea>
        <input type="file" id="image" accept="image/*" required />
        <button type="submit">Submit Artwork</button>
      </form>
      <p id="submission-status"></p>
    </section>

    <section id="curator-section" class="panel-section hidden">
      <h2>Curator Approval</h2>
      <ul id="submitted-artworks"></ul>
    </section>
  </main>

  <script type="module">
    import { ethers } from "./ethers.min.js";
    import { abi } from "./NANdARTGalleryABI.js";

    const contractAddress = "0xYourContractAddressHere";
    const contract = new ethers.Contract(contractAddress, abi);

    const userAddress = await window.ethereum.request({ method: 'eth_requestAccounts' }).then(a => a[0]);
    const isWhitelisted = await contract.isWhitelisted(userAddress);
    const isCurator = await contract.owner() === userAddress;

    document.getElementById('artist-section').classList.toggle('hidden', !isWhitelisted || isCurator);
    document.getElementById('curator-section').classList.toggle('hidden', !isCurator);

    // SubmissÃ£o
    document.getElementById('submit-art-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const year = document.getElementById('year').value;
      const description = document.getElementById('description').value;
      const file = document.getElementById('image').files[0];

      const formData = new FormData();
      formData.append('title', title);
      formData.append('year', year);
      formData.append('description', description);
      formData.append('image', file);

      const res = await fetch('https://your-backend-url.com/submit', {
        method: 'POST',
        body: formData
      });

      const result = await res.json();
      document.getElementById('submission-status').textContent = result.message;
    });

    // Curadoria
    async function loadSubmissions() {
      const res = await fetch('https://your-backend-url.com/pending');
      const submissions = await res.json();
      const list = document.getElementById('submitted-artworks');
      list.innerHTML = '';

      submissions.forEach(sub => {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${sub.title}</strong> (${sub.year})<br/>
          <em>${sub.description}</em><br/>
          <img src="${sub.imageUrl}" width="100"/><br/>
          <button onclick="approve('${sub.tokenURI}', '${sub.artist}')">Approve & Mint</button>
          <button onclick="reject('${sub.id}')">Reject</button>
        `;
        list.appendChild(li);
      });
    }

    window.approve = async function(tokenURI, artist) {
      const tx = await contract.mintComCuradoria(artist, tokenURI, { value: ethers.utils.parseEther("0.05") });
      await tx.wait();
      alert("NFT minted successfully");
    };

    window.reject = async function(id) {
      await fetch(`https://your-backend-url.com/reject/${id}`, { method: 'POST' });
      alert("Submission rejected");
    };

    if (isCurator) loadSubmissions();
  </script>
</body>
</html>
