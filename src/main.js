import * as THREE from 'three';import{Reflector}from 'three/addons/objects/Reflector.js';import{FontLoader}from 'three/addons/loaders/FontLoader.js';import{TextGeometry}from 'three/addons/geometries/TextGeometry.js';import gsap from 'gsap';import{ScrollTrigger}from 'gsap/ScrollTrigger';import{MotionPathPlugin}from 'gsap/MotionPathPlugin';import{ethers}from 'ethers';import{obrasSuspensas}from './data/obras-suspensas.js';console.log('üé® A iniciar a galeria 3D NANdART...');if(!THREE||!gsap||!ethers){const e=document.createElement('div');e.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:#111;color:#ff6b6b;display:flex;justify-content:center;align-items:center;font-family:Arial,sans-serif;text-align:center;z-index:10000;padding:20px;';e.innerHTML='<div><h2>Erro cr√≠tico</h2><p>Bibliotecas essenciais n√£o foram carregadas.</p><p>Verifica a liga√ß√£o √† internet e recarrega a p√°gina.</p></div>';document.body.appendChild(e);throw new Error('‚ùå Bibliotecas essenciais em falta')}gsap.registerPlugin(ScrollTrigger,MotionPathPlugin);let config,obraDestacada=null,ambienteDesacelerado=!1,obrasNormais=[],cubosSuspensos=[],relogio=new THREE.Clock(),anguloAtual=0,overlay,infoPanel,modalElements={titulo:null,artista:null,ano:null,descricao:null,preco:null,botao:null},efeitoDesfoque=null,nomeGaleria="NANdART",iconeMenu='assets/icons/horizontes.png',iconeInfo='assets/icons/info.png',iconeAjuda='assets/icons/ajuda-flutuante.png',configMap={XS:{obraSize:.9,circleRadius:2.4,wallDistance:8,cameraZ:22,cameraY:7.8,textSize:.4},SM:{obraSize:1.1,circleRadius:2.8,wallDistance:9.5,cameraZ:24,cameraY:8.3,textSize:.45},MD:{obraSize:1.3,circleRadius:3.3,wallDistance:10.5,cameraZ:26,cameraY:8.9,textSize:.5},LG:{obraSize:1.45,circleRadius:3.6,wallDistance:11,cameraZ:28,cameraY:9.2,textSize:.55}};function getViewportLevel(){const e=window.innerWidth;return e<480?'XS':e<768?'SM':e<1024?'MD':'LG'}config=configMap[getViewportLevel()];let loadedResources=0,totalResources=10+obrasSuspensas.length;function updateLoadingProgress(){loadedResources++,loadedResources>=totalResources&&console.log('üñºÔ∏è Recursos carregados silenciosamente.')}const loadingManager=new THREE.LoadingManager;loadingManager.onLoad=updateLoadingProgress,loadingManager.onError=e=>console.warn(`‚ö†Ô∏è Falha ao carregar recurso: ${e}`),textureLoader=new THREE.TextureLoader(loadingManager),renderer=new THREE.WebGLRenderer({canvas:document.getElementById('scene'),antialias:!0,powerPreference:'high-performance',failIfMajorPerformanceCaveat:!0});renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.toneMapping=THREE.ACESFilmicToneMapping,renderer.toneMappingExposure=2.8,renderer.outputColorSpace=THREE.SRGBColorSpace;const scene=new THREE.Scene;scene.background=new THREE.Color(1118481);const camera=new THREE.PerspectiveCamera(34,window.innerWidth/window.innerHeight,.1,100);function updateCamera(){config=configMap[getViewportLevel()],camera.position.set(0,config.cameraY+1.6,config.cameraZ+6.5),camera.lookAt(0,6.5,-config.wallDistance+.4),camera.updateProjectionMatrix()}updateCamera();let resizeTimeout;window.addEventListener('resize',()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{updateCamera(),renderer.setSize(window.innerWidth,window.innerHeight),obraDestacada&&'block'===infoPanel?.style?.display&&(e=>{const t=obraDestacada.position.clone().project(camera),n=(t.x*.5+.5)*window.innerWidth,i=(1-(t.y*.5+.5))*window.innerHeight,a=260;infoPanel.style.left=`${n-a/2}px`,infoPanel.style.top=`${i+160}px`,infoPanel.style.width=`${a}px`})()},200)});const ambientLight=new THREE.AmbientLight(16766790,1.4);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(16772292,1);directionalLight.position.set(4,15,10),directionalLight.castShadow=!0,directionalLight.shadow.mapSize.width=2048,directionalLight.shadow.mapSize.height=2048,directionalLight.shadow.bias=-5e-4,scene.add(directionalLight);const fillLeft=new THREE.DirectionalLight(16772428,.55);fillLeft.position.set(-10,9,3),fillLeft.castShadow=!0,scene.add(fillLeft);const fillRight=new THREE.DirectionalLight(16772428,.55);fillRight.position.set(10,9,-3),fillRight.castShadow=!0,scene.add(fillRight);const spotCentral=new THREE.SpotLight(16773077,1.2,25,Math.PI/6,.3,1);spotCentral.position.set(0,15,0),spotCentral.target.position.set(0,0,0),spotCentral.castShadow=!0,spotCentral.shadow.mapSize.width=1024,spotCentral.shadow.mapSize.height=1024,scene.add(spotCentral),scene.add(spotCentral.target);const paredeGeoFundo=new THREE.BoxGeometry(42,29,.4),paredeGeoLateral=new THREE.BoxGeometry(30,29,.4),texturaParede=textureLoader.load('assets/antracite-realista.jpg',updateLoadingProgress),normalParede=textureLoader.load('assets/antracite-normal.jpg',updateLoadingProgress);function aplicarTexturaParede(e,t=null){const n=new THREE.MeshStandardMaterial({map:e||null,normalMap:t||null,normalScale:new THREE.Vector2(1.4,1.4),color:16777215,emissive:1118481,emissiveIntensity:.28,roughness:.58,metalness:.18}),i=new THREE.Mesh(paredeGeoFundo,n.clone());i.position.set(0,14.6,-config.wallDistance-5.2),i.receiveShadow=!0,scene.add(i);const a=new THREE.Mesh(paredeGeoLateral,n.clone());a.position.set(-16.7,14.5,-config.wallDistance/2),a.rotation.y=Math.PI/2,a.receiveShadow=!0,scene.add(a);const r=new THREE.Mesh(paredeGeoLateral,n.clone());r.position.set(16.7,14.5,-config.wallDistance/2),r.rotation.y=-Math.PI/2,r.receiveShadow=!0,scene.add(r)}aplicarTexturaParede(texturaParede,normalParede);const base64MarbleTexture="data:image/png;base64,iVBORw0KGgoAAA...",textureMarble=new THREE.TextureLoader().load('assets/marble-polished.jpg',()=>{console.log('‚úÖ Textura externa de m√°rmore carregada com sucesso.');const e=new THREE.PlaneGeometry(80,80),t=new THREE.MeshStandardMaterial({map:textureMarble,metalness:.4,roughness:.08,emissive:new THREE.Color(1118481),emissiveIntensity:.12}),n=new THREE.Mesh(e,t);n.rotation.x=-Math.PI/2,n.position.y=-.03,n.receiveShadow=!0,scene.add(n)},void 0,()=>{console.warn('‚ö†Ô∏è Falha na textura externa. A aplicar fallback embutido.');const e=new Image;e.src=base64MarbleTexture;const t=new THREE.Texture(e);e.onload=()=>{t.needsUpdate=!0;const n=new THREE.PlaneGeometry(80,80),i=new THREE.MeshStandardMaterial({map:t,metalness:.4,roughness:.08,emissive:new THREE.Color(1118481),emissiveIntensity:.12}),a=new THREE.Mesh(n,i);a.rotation.x=-Math.PI/2,a.position.y=-.03,a.receiveShadow=!0,scene.add(a)}});const frisoMaterial=new THREE.MeshStandardMaterial({color:9067041,metalness:.7,roughness:.3,emissive:0,emissiveIntensity:.1});function criarFrisoCentral(e,t,n,i,a){const r=.3,o=.02,s=new THREE.Shape;s.moveTo(-i/2+r,-a/2),s.lineTo(i/2-r,-a/2),s.quadraticCurveTo(i/2,-a/2,i/2,-a/2+r),s.lineTo(i/2,a/2-r),s.quadraticCurveTo(i/2,a/2,i/2-r,a/2),s.lineTo(-i/2+r,a/2),s.quadraticCurveTo(-i/2,a/2,-i/2,a/2-r),s.lineTo(-i/2,-a/2+r),s.quadraticCurveTo(-i/2,-a/2,-i/2+r,-a/2);const l={depth:o,bevelEnabled:!1},c=new THREE.ExtrudeGeometry(s,l),d=new THREE.Mesh(c,frisoMaterial);d.position.set(e,t,n),scene.add(d)}criarFrisoCentral(0,11.2,-config.wallDistance-5.17,5.2,6.3);function criarFrisoLinha(e,t,n,i,a=.06,r=0){const o=new THREE.Mesh(new THREE.BoxGeometry(i,a,.02),frisoMaterial);o.position.set(e,t,n),o.rotation.y=r,scene.add(o)}function criarFrisoDuploVertical(e,t,n,i,a){const r='esquerda'===a?.4:.4,o=new THREE.Mesh(new THREE.BoxGeometry(.18,i,.02),frisoMaterial);o.position.set(e,t,n),o.rotation.y='esquerda'===a?Math.PI/2:-Math.PI/2,scene.add(o);const s=new THREE.Mesh(new THREE.BoxGeometry(.08,i-.4,.02),frisoMaterial);s.position.set(e+r,t,n+.01),s.rotation.y=o.rotation.y,scene.add(s)}criarFrisoLinha(0,1.6,-config.wallDistance-5.18,42),criarFrisoLinha(0,2.2,-config.wallDistance-5.18,42),criarFrisoLinha(-16.7,1.6,-config.wallDistance/2,30,.06,Math.PI/2),criarFrisoLinha(-16.7,2.2,-config.wallDistance/2,30,.06,Math.PI/2),criarFrisoLinha(16.7,1.6,-config.wallDistance/2,30,.06,-Math.PI/2),criarFrisoLinha(16.7,2.2,-config.wallDistance/2,30,.06,-Math.PI/2),criarFrisoDuploVertical(-16.7,14.5,-config.wallDistance/2,7.5,'esquerda'),criarFrisoDuploVertical(16.7,14.5,-config.wallDistance/2,7.5,'direita');const icones=[{imagem:'assets/icons/horizontes.png',largura:1.8,altura:1.2,posicao:new THREE.Vector3(-6.2,22.2,-config.wallDistance-5.19)},{imagem:'assets/icons/info.png',largura:1.6,altura:1.1,posicao:new THREE.Vector3(-6.2,23.6,-config.wallDistance-5.19)},{imagem:'assets/icons/metamask.svg',largura:1.7,altura:1.3,posicao:new THREE.Vector3(6.2,22.6,-config.wallDistance-5.19)}];icones.forEach(({imagem:e,largura:t,altura:n,posicao:i})=>{textureLoader.load(e,e=>{const t=new THREE.Mesh(new THREE.PlaneGeometry(n,i),new THREE.MeshBasicMaterial({map:e,transparent:!0,side:THREE.DoubleSide}));t.position.copy(i),scene.add(t)},void 0,()=>{console.warn(`‚ö†Ô∏è Falha ao carregar o √≠cone: ${e}`)})});const pedestalMaterial=new THREE.MeshStandardMaterial({color:2829099,roughness:.5,metalness:.25}),vitrineMaterial=new THREE.MeshPhysicalMaterial({color:1703968,metalness:.1,roughness:0,transparent:!0,opacity:.18,transmission:1,thickness:.25,reflectivity:.5,clearcoat:1,clearcoatRoughness:.1}),gemaMaterial=new THREE.MeshStandardMaterial({color:3394815,emissive:3394815,emissiveIntensity:1.8,roughness:.1,metalness:.3,transparent:!0,opacity:.85});function criarPedestalRetangular(e,t){const n=.8,i=1.5,a=1.3,r=new THREE.Mesh(new THREE.BoxGeometry(n,i,n),pedestalMaterial);r.position.set(e,i/2,t),r.castShadow=r.receiveShadow=!0,scene.add(r);const o=new THREE.Mesh(new THREE.BoxGeometry(n*.9,a,n*.9),vitrineMaterial);o.position.set(e,i+a/2,t),o.castShadow=o.receiveShadow=!0,scene.add(o);const s=new THREE.Mesh(new THREE.IcosahedronGeometry(.35,1),gemaMaterial);s.position.set(e,i+a/2,t),scene.add(s)}const deslocamento=config.circleRadius+3.3;criarPedestalRetangular(-deslocamento,-deslocamento),criarPedestalRetangular(deslocamento,-deslocamento),criarPedestalRetangular(-deslocamento,deslocamento),criarPedestalRetangular(deslocamento,deslocamento);const circuloLuzGeometry=new THREE.RingGeometry(config.circleRadius+.6,config.circleRadius+1.4,64),circuloLuzMaterial=new THREE.MeshStandardMaterial({color:16772804,emissive:16772804,emissiveIntensity:.9,roughness:.4,metalness:.1,transparent:!0,opacity:.48,side:THREE.DoubleSide}),circuloLuz=new THREE.Mesh(circuloLuzGeometry,circuloLuzMaterial);circuloLuz.rotation.x=-Math.PI/2,circuloLuz.position.y=2e-5,scene.add(circuloLuz);const frisoChao=new THREE.Mesh(new THREE.BoxGeometry(config.circleRadius*2+2.5,.04,.02),frisoMaterial);frisoChao.position.set(0,.0055,-config.wallDistance/2+.2),scene.add(frisoChao);const dadosObras=[{id:'obra1',titulo:'Obra 1',artista:'Artista A',ano:'2024',descricao:'Descri√ß√£o da Obra 1.',preco:'0.5',imagem:'assets/obras/obra1.jpg'},{id:'obra2',titulo:'Obra 2',artista:'Artista B',ano:'2023',descricao:'Descri√ß√£o da Obra 2.',preco:'0.6',imagem:'assets/obras/obra2.jpg'},{id:'obra3',titulo:'Obra 3',artista:'Artista C',ano:'2025',descricao:'Descri√ß√£o da Obra 3.',preco:'0.45',imagem:'assets/obras/obra3.jpg'},{id:'obra4',titulo:'Obra 4',artista:'Artista D',ano:'2022',descricao:'Descri√ß√£o da Obra 4.',preco:'0.55',imagem:'assets/obras/obra4.jpg'},{id:'obra5',titulo:'Obra 5',artista:'Artista E',ano:'2021',descricao:'Descri√ß√£o da Obra 5.',preco:'0.65',imagem:'assets/obras/obra5.jpg'},{id:'obra6',titulo:'Obra 6',artista:'Artista F',ano:'2021',descricao:'Descri√ß√£o da Obra 6.',preco:'0.42',imagem:'assets/obras/obra6.jpg'},{id:'obra7',titulo:'Obra 7',artista:'Artista G',ano:'2020',descricao:'Descri√ß√£o da Obra 7.',preco:'0.48',imagem:'assets/obras/obra7.jpg'},{id:'obra8',titulo:'Obra 8',artista:'Artista H',ano:'2020',descricao:'Descri√ß√£o da Obra 8.',preco:'0.58',imagem:'assets/obras/obra8.jpg'}];function criarObrasNormais(){const e=config.circleRadius,t=config.obraSize;dadosObras.forEach((n,i)=>{textureLoader.load(n.imagem,a=>{const r=new THREE.Mesh(new THREE.PlaneGeometry(t*1.3,t*1.6),new THREE.MeshStandardMaterial({map:a,roughness:.2,metalness:.1,side:THREE.DoubleSide,transparent:!0}));const o=i/dadosObras.length*Math.PI*2;r.position.set(Math.cos(o)*e,4.2,Math.sin(o)*e),r.lookAt(0,4.2,0),r.castShadow=r.receiveShadow=!0,r.userData={dados:n,index:i},scene.add(r),obrasNormais.push(r),updateLoadingProgress()},void 0,e=>{console.error(`Erro ao carregar imagem da obra ${n.titulo}:`,e);const a=new THREE.Mesh(new THREE.PlaneGeometry(t*1.3,t*1.6),new THREE.MeshStandardMaterial({color:3355443,roughness:.2,metalness:.1,side:THREE.DoubleSide,transparent:!0}));const r=i/dadosObras.length*Math.PI*2;a.position.set(Math.cos(r)*e,4.2,Math.sin(r)*e),a.lookAt(0,4.2,0),a.castShadow=a.receiveShadow=!0,a.userData={dados:n,index:i},scene.add(a),obrasNormais.push(a),updateLoadingProgress()})})}const velocidadeObras=.2;function animarObrasCirculares(e){obraDestacada||(anguloAtual+=velocidadeObras*e),ambienteDesacelerado&&(anguloAtual+=.1*velocidadeObras*e);const t=config.circleRadius;obrasNormais.forEach((n,i)=>{if(n===obraDestacada)return;const a=i/obrasNormais.length*Math.PI*2+anguloAtual;n.position.set(Math.cos(a)*t,4.2,Math.sin(a)*t),n.lookAt(0,4.2,0)})}renderer.domElement.addEventListener('pointerdown',e=>{if(obraDestacada)return;const t=new THREE.Vector2(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight)*2+1),n=new THREE.Raycaster;n.setFromCamera(t,camera);const i=n.intersectObjects(obrasNormais,!1);i.length>0&&destacarObra(i[0].object)});function destacarObra(e){if(obraDestacada)return;obraDestacada=e,ambienteDesacelerado=!0;const t=e.userData.dados;obrasNormais.forEach(e=>{e!==obraDestacada&&(e.visible=!1)}),gsap.to(e.position,{x:0,y:6.5,z:0,duration:1.1,ease:'power2.inOut',onUpdate:()=>{e.lookAt(new THREE.Vector3(0,6.5,0))},onComplete:()=>{e.lookAt(new THREE.Vector3(0,6.5,0))}}),gsap.to(e.scale,{x:2,y:2,z:2,duration:.9,ease:'power2.out'}),setTimeout(()=>{overlay=document.getElementById('overlay'),infoPanel=document.getElementById('info-panel');overlay&&infoPanel&&(overlay.style.display='block',infoPanel.style.display='block',modalElements.titulo.textContent=t.titulo,modalElements.artista.textContent=t.artista,modalElements.ano.textContent=t.ano,modalElements.descricao.textContent=t.descricao||'Obra em destaque na galeria NANdART.',modalElements.preco.textContent=`${t.preco} ETH`,(e=>{const t=obraDestacada.position.clone().project(camera),n=(t.x*.5+.5)*window.innerWidth,i=(1-(t.y*.5+.5))*window.innerHeight,a=260;infoPanel.style.position='absolute',infoPanel.style.left=`${n-a/2}px`,infoPanel.style.top=`${i+160}px`,infoPanel.style.width=`${a}px`,infoPanel.style.zIndex='200',infoPanel.style.transition='all 0.3s ease'})())},1100)}document.addEventListener('pointerdown',e=>{obraDestacada&&(!infoPanel||!infoPanel.contains(e.target))&&fecharObraDestacada()});function fecharObraDestacada(){if(!obraDestacada)return;const e=obraDestacada,t=e.userData.index,n=t/obrasNormais.length*Math.PI*2;gsap.to(e.position,{x:Math.cos(n)*config.circleRadius,y:4.2,z:Math.sin(n)*config.circleRadius,duration:1.2,ease:'power2.inOut',onComplete:()=>{obrasNormais.forEach(e=>e.visible=!0),obraDestacada=null,ambienteDesacelerado=!1}}),gsap.to(e.scale,{x:1,y:1,z:1,duration:.6,ease:'power2.out'}),infoPanel&&overlay&&(infoPanel.style.transition='opacity 0.4s ease',overlay.style.transition='opacity 0.4s ease',infoPanel.style.opacity='0',overlay.style.opacity='0',setTimeout(()=>{infoPanel.style.display='none',overlay.style.display='none',infoPanel.style.opacity='1',overlay.style.opacity='1'},400))}window.addEventListener('DOMContentLoaded',()=>{modalElements.titulo=document.getElementById('modal-titulo'),modalElements.artista=document.getElementById('modal-artista'),modalElements.ano=document.getElementById('modal-ano'),modalElements.descricao=document.getElementById('modal-descricao'),modalElements.preco=document.getElementById('modal-preco');const e=document.getElementById('obra-buy');e&&(modalElements.botao=e,e.addEventListener('click',async()=>{const t=obraDestacada?.userData?.dados;if(!t||!t.preco||!t.titulo)return void alert('Erro: dados da obra n√£o encontrados.');if(!window.ethereum)return void alert('MetaMask n√£o est√° instalada. Por favor, instala-a para continuares.');try{modalElements.botao.disabled=!0,modalElements.botao.textContent='A processar...',await window.ethereum.request({method:'eth_requestAccounts'});const e=new ethers.BrowserProvider(window.ethereum),n=await e.getSigner(),i=await n.sendTransaction({to:'0x913b3984583Ac44dE06Ef480a8Ac925DEA378b41',value:ethers.parseEther(t.preco)});alert(`üßæ Transac√ß√£o enviada!\n\nHash:\n${i.hash}`),await i.wait(),alert('üéâ Compra confirmada! Obrigado por apoiar a arte digital.'),fecharObraDestacada()}catch(e){console.error('‚ùå Erro na compra:',e),alert('‚ö†Ô∏è Ocorreu um erro durante a compra. Verifica a carteira e tenta novamente.')}finally{modalElements.botao.disabled=!1,modalElements.botao.textContent='Buy'}}),console.error('‚ùå Bot√£o Buy n√£o encontrado no DOM.'))});function criarCuboSuspenso(e,t){const n=1.5,i=new THREE.MeshPhysicalMaterial({color:2236962,transparent:!0,opacity:.18,roughness:.25,metalness:.5,clearcoat:.8,clearcoatRoughness:.2,reflectivity:.3}),a=new THREE.Mesh(new THREE.BoxGeometry(n,n,n),i);a.castShadow=a.receiveShadow=!0;const r=8.2,o=[{x:-5,y:r,z:0},{x:5,y:r,z:0},{x:-5,y:r,z:-5},{x:5,y:r,z:-5}],s=o[t%o.length];a.position.set(s.x,s.y,s.z),textureLoader.load(e.imagem,t=>{const n=new THREE.Mesh(new THREE.IcosahedronGeometry(.6,1),new THREE.MeshStandardMaterial({map:t,emissive:3374668,emissiveIntensity:2,transparent:!0,opacity:.9}));n.castShadow=n.receiveShadow=!0,a.add(n),updateLoadingProgress()},void 0,()=>{const e=new THREE.Mesh(new THREE.IcosahedronGeometry(.6,1),new THREE.MeshStandardMaterial({color:3374668,emissive:3374668,emissiveIntensity:2,transparent:!0,opacity:.9}));e.castShadow=e.receiveShadow=!0,a.add(e),updateLoadingProgress()}),a.userData={obra:e},cubosSuspensos.push(a),scene.add(a);return a}const BACKEND_URL='https://nandart-3d.onrender.com';async function registarEntradaBackend(e){try{const t=await fetch(`${BACKEND_URL}/api/entradas`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({obraId:e})});if(!t.ok)throw new Error(`Resposta n√£o OK: ${t.status}`);const n=await t.json(),i=new Date(n.data).toLocaleDateString('pt-PT');console.log(`üìå Entrada registada: ${e} ‚Üí ${i}`)}catch(e){console.error(`‚ùå Erro ao registar entrada da obra ${e}:`,e.message||e)}}async function verificarMigracoesBackend(){try{const e=await fetch(`${BACKEND_URL}/api/verificar-migracoes`);if(!e.ok)throw new Error(`Resposta n√£o OK: ${e.status}`);const t=await e.json();Array.isArray(t)&&(t.forEach(e=>{migrarParaCirculo(e)}),console.log(`üîÑ Migra√ß√µes processadas: ${t.length}`))}catch(e){console.error('‚ùå Erro ao verificar migra√ß√µes no backend:',e.message||e)}}const walletBtn=document.createElement('button');walletBtn.id='wallet-button',walletBtn.textContent='Connect Wallet',walletBtn.style.cssText='position:fixed;top:18px;right:20px;z-index:250;padding:10px 18px 10px 42px;font-size:1em;background-color:#d8b26c;color:#111;border:none;border-radius:6px;font-family:\'Playfair Display\',serif;cursor:pointer;box-shadow:0 0 8px rgba(255,215,0,0.3);background-image:url(\'assets/icons/metamask.svg\');background-repeat:no-repeat;background-position:12px center;background-size:20px 20px;transition:background-color 0.3s ease,transform 0.2s ease;',document.body.appendChild(walletBtn);let walletAddress=null;async function atualizarEstadoCarteira(){if(walletAddress){const e=new ethers.BrowserProvider(window.ethereum),t=await e.getBalance(walletAddress),n=ethers.formatEther(t);walletBtn.textContent=`Disconnect (${walletAddress.slice(0,6)}...${walletAddress.slice(-4)} | ${parseFloat(n).toFixed(4)} ETH)`}else walletBtn.textContent='Connect Wallet'}async function conectarCarteira(){try{if(!window.ethereum)return void alert('MetaMask n√£o est√° instalada. Por favor, instala-a para continuar.');const e=await window.ethereum.request({method:'eth_requestAccounts'});walletAddress=e[0],localStorage.setItem('walletConnected','true'),atualizarEstadoCarteira()}catch(e){console.error('‚ùå Erro ao ligar carteira:',e),alert('N√£o foi poss√≠vel ligar a carteira. Tenta novamente.')}}function desligarCarteira(){walletAddress=null,localStorage.removeItem('walletConnected'),atualizarEstadoCarteira()}walletBtn.addEventListener('click',()=>{walletAddress?desligarCarteira():conectarCarteira()}),window.addEventListener('load',async()=>{if(window.ethereum&&'true'===localStorage.getItem('walletConnected'))try{const e=await window.ethereum.request({method:'eth_accounts'});e.length>0?(walletAddress=e[0],atualizarEstadoCarteira()):(localStorage.removeItem('walletConnected'),walletAddress=null,atualizarEstadoCarteira())}catch(e){console.error('‚ùå Erro ao verificar liga√ß√£o persistente da carteira:',e),localStorage.removeItem('walletConnected')}});function iniciarGaleria(){criarObrasNormais(),obrasSuspensas.forEach((e,t)=>{criarCuboSuspenso(e,t),registarEntradaBackend(e.id)}),verificarMigracoesBackend()}window.addEventListener('load',iniciarGaleria);function animate(){requestAnimationFrame(animate);const e=relogio.getDelta();animarObrasCirculares(e),renderer.render(scene,camera)}animate();
